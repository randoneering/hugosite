<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Stay awhile, and listen...to my nixOS journey! | </title>
<meta name="keywords" content="" />
<meta name="description" content="Taking immutable to a new level">
<meta name="author" content="Justin@Randoneering">
<link rel="canonical" href="/blog/nixosjourneyp1/" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.8550f40606bc997610bf512fb7e6b88d8d608543e163d892a5ff925458006087.css" integrity="sha256-hVD0Bga8mXYQv1Evt&#43;a4jY1ghUPhY9iSpf&#43;SVFgAYIc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/images/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="mask-icon" href="/images/apple-touch-icon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <ul id="menu">
            <li>
                <a href="/" title="Home"><span>Home</span></a>
            </li>
            <li>
                <a href="/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="">Home</a>&nbsp;»&nbsp;<a href="/blog/">Blog</a></div>
    <h1 class="post-title">
      Stay awhile, and listen...to my nixOS journey!
    </h1>
    <div class="post-description">
      Taking immutable to a new level
    </div>
    <div class="post-meta">December 29, 2023 - 6 min - Justin@Randoneering</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#nixos-journey-part-1" aria-label="NixOS Journey, Part 1">NixOS Journey, Part 1</a><ul>
                        
                <li>
                    <a href="#are-you-starting-to-get-it-yet" aria-label="Are you starting to get it yet?">Are you starting to get it yet?</a></li>
                <li>
                    <a href="#the-nixos-config" aria-label="The NixOS Config">The NixOS Config</a></li>
                <li>
                    <a href="#the-planned-outcome" aria-label="The &amp;lsquo;Planned&amp;rsquo; Outcome">The &lsquo;Planned&rsquo; Outcome</a><ul>
                        
                <li>
                    <a href="#the-stretch-goal" aria-label="The Stretch Goal">The Stretch Goal</a></li>
                <li>
                    <a href="#nixos-config-as-of-20231229" aria-label="NixOS Config (as of 2023/12/29)">NixOS Config (as of 2023/12/29)</a>
                </li>
            </ul>
            </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content">
  <h1 id="nixos-journey-part-1">NixOS Journey, Part 1</h1>
<p>So, for those who have yet to go down this path, it would be helpful to explain what NixOS is. NixOS is a free and open-source Linux distribution. What sets itself apart from Pop!os, Debian, Ubuntu, Arch, and many others is that its entire operating system is built by the Nix package manager. This includes nix application packages, your kernel, system settings, SMB shares, and pretty much anything you can think of.</p>
<p>What this allows the users to do is work within a declarativve configuration. If you make a change to the configuration file and want the changes to take, you run <code>nixos-rebuild switch</code>. NixOS then takes in the new changes, goes out to get new packages if needed, and generates a new configuration file. If this breaks anything or you just want to go back to the previous version, all you have to do is <code>nixos-rebuild switch --rollback</code>. Even on boot, you are presented with previous <code>nixos-rebuild</code> events that you can select and boot right into. Combine this with commiting to github or version control manager and you could start sharing your configs with other devices.</p>
<h2 id="are-you-starting-to-get-it-yet">Are you starting to get it yet?</h2>
<p>To most, even the seasoned Linux user, nixOS can be daunting at a glance. It takes every fiber of my being not to install packages via <code>apt install</code> or <code>snap install</code> or <code>yum install</code>. Finding packages that the community and nixOS team have compiled specifically for nixOS is easy, and can be done by searching directly on the site (<a href="https://search.nixos.org/packages)">https://search.nixos.org/packages)</a>. However, there is a possibility that your favorite package may not be packaged yet. You can request that package be assembled via github (<a href="https://github.com/NixOS/nixpkgs/issues)">https://github.com/NixOS/nixpkgs/issues)</a>. I am currently hoping for tabby.sh to be packaged up for me so I can use my favorite terminal app. Someone already requested it, but fingers crossed it gets done!</p>
<p>But the catch is, while you can &ldquo;install&rdquo; packages using <code>nix-env -iA cider</code>, for example. This installs at the user level, so it will not be system wide and will not appear in your nixOS config. Additionally, you can try out a package without installing it by running <code>nix shell</code>, and a shell instance will run the package. When the shell instance is terminated, it will no longer persist on your device.</p>
<h2 id="the-nixos-config">The NixOS Config</h2>
<p>I have referenced the &ldquo;nixOS config&rdquo; file a few times now, which is the whole reason why I wanted to try nixOS out. It is just like any config file, but you can declare your entire state in this SINGLE file. Got a bunch of guh-nome (gnome) extensions you always setup on a fresh install? Yeah, you can declare that in your nix config file. Packages? Easy, all in the config file. Services like your vpn, syncthing shared folders, and your tailscale mesh network? Ye&hellip;you get the point.</p>
<h2 id="the-planned-outcome">The &lsquo;Planned&rsquo; Outcome</h2>
<p>The whole purpose of this is for me to, at the end of all of this fiddling around, have a nixOS config file that I can pull down from my private repo, run <code>nixos-rebuild switch</code> and let the device configure itself. I want to be able to do this on all of my laptops or desktops that I come in possession of. That way, I have the same desktop environment switching from one device to the next.</p>
<h3 id="the-stretch-goal">The Stretch Goal</h3>
<p>You know what would be really nice? Moving all my servers over from Debian and Ubuntu to nixOS&hellip;&hellip;&hellip;..</p>
<h3 id="nixos-config-as-of-20231229">NixOS Config (as of 2023/12/29)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
<span style="color:#f92672">{</span> config, pkgs, ... <span style="color:#f92672">}</span>:

<span style="color:#f92672">{</span>
  imports <span style="color:#f92672">=</span>
    <span style="color:#f92672">[</span> <span style="color:#75715e"># Include the results of the hardware scan.</span>
      ./hardware-configuration.nix
    <span style="color:#f92672">]</span>;

  <span style="color:#75715e"># Bootloader.</span>
  boot.loader.systemd-boot.enable <span style="color:#f92672">=</span> true;
  boot.loader.efi.canTouchEfiVariables <span style="color:#f92672">=</span> true;

  networking.hostName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;nixos&#34;</span>; <span style="color:#75715e"># Define your hostname.</span>
  <span style="color:#75715e"># networking.wireless.enable = true;  # Enables wireless support via wpa_supplicant.</span>

  <span style="color:#75715e"># Configure network proxy if necessary</span>
  <span style="color:#75715e"># networking.proxy.default = &#34;http://user:password@proxy:port/&#34;;</span>
  <span style="color:#75715e"># networking.proxy.noProxy = &#34;127.0.0.1,localhost,internal.domain&#34;;</span>

  <span style="color:#75715e"># Enable networking</span>
  networking.networkmanager.enable <span style="color:#f92672">=</span> true;

  <span style="color:#75715e"># Set your time zone.</span>
  time.timeZone <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;America/Chicago&#34;</span>;

  <span style="color:#75715e"># Select internationalisation properties.</span>
  i18n.defaultLocale <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;

  i18n.extraLocaleSettings <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    LC_ADDRESS <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_IDENTIFICATION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_MEASUREMENT <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_MONETARY <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_NUMERIC <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_PAPER <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_TELEPHONE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
    LC_TIME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;en_US.UTF-8&#34;</span>;
  <span style="color:#f92672">}</span>;

  <span style="color:#75715e"># Enable the X11 windowing system.</span>
  services.xserver.enable <span style="color:#f92672">=</span> true;

  <span style="color:#75715e"># Enable the GNOME Desktop Environment.</span>
  services.xserver.displayManager.gdm.enable <span style="color:#f92672">=</span> true;
  services.xserver.desktopManager.gnome.enable <span style="color:#f92672">=</span> true;
  
  <span style="color:#75715e"># Tailcale</span>
  services.tailscale.enable <span style="color:#f92672">=</span> true;
  
  <span style="color:#75715e"># Configure keymap in X11</span>
  services.xserver <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    layout <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;us&#34;</span>;
    xkbVariant <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
  <span style="color:#f92672">}</span>;

  <span style="color:#75715e"># Enable CUPS to print documents.</span>
  services.printing.enable <span style="color:#f92672">=</span> true;

  <span style="color:#75715e"># Enable sound with pipewire.</span>
  sound.enable <span style="color:#f92672">=</span> true;
  hardware.pulseaudio.enable <span style="color:#f92672">=</span> false;
  security.rtkit.enable <span style="color:#f92672">=</span> true;
  services.pipewire <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    enable <span style="color:#f92672">=</span> true;
    alsa.enable <span style="color:#f92672">=</span> true;
    alsa.support32Bit <span style="color:#f92672">=</span> true;
    pulse.enable <span style="color:#f92672">=</span> true;
    <span style="color:#75715e"># If you want to use JACK applications, uncomment this</span>
    <span style="color:#75715e">#jack.enable = true;</span>

    <span style="color:#75715e"># use the example session manager (no others are packaged yet so this is enabled by default,</span>
    <span style="color:#75715e"># no need to redefine it in your config for now)</span>
    <span style="color:#75715e">#media-session.enable = true;</span>
  <span style="color:#f92672">}</span>;

  <span style="color:#75715e"># Enable touchpad support (enabled default in most desktopManager).</span>
  <span style="color:#75715e"># services.xserver.libinput.enable = true;</span>

  <span style="color:#75715e"># Define a user account. Don&#39;t forget to set a password with ‘passwd’.</span>
  users.users.randoneering <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    isNormalUser <span style="color:#f92672">=</span> true;
    description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;randoneering&#34;</span>;
    extraGroups <span style="color:#f92672">=</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;networkmanager&#34;</span> <span style="color:#e6db74">&#34;wheel&#34;</span> <span style="color:#f92672">]</span>;
    packages <span style="color:#f92672">=</span> with pkgs; <span style="color:#f92672">[</span>
      firefox
    <span style="color:#75715e">#  thunderbird</span>
    <span style="color:#f92672">]</span>;
  <span style="color:#f92672">}</span>;

  <span style="color:#75715e"># Allow unfree packages</span>
  nixpkgs.config.allowUnfree <span style="color:#f92672">=</span> true;

  nixpkgs.config.permittedInsecurePackages <span style="color:#f92672">=</span> <span style="color:#f92672">[</span>
                <span style="color:#e6db74">&#34;electron-24.8.6&#34;</span>
              <span style="color:#f92672">]</span>;

  <span style="color:#75715e"># List packages installed in system profile. To search, run:</span>
  <span style="color:#75715e"># $ nix search wget</span>
  environment.systemPackages <span style="color:#f92672">=</span> with pkgs; <span style="color:#f92672">[</span>
      firefox
      element-desktop
      discord
      cider
      vscodium
      remmina
      wget
      neofetch
      signal-desktop
      obsidian
      syncthing
      gnome-extension-manager
      git
      steam
      bitwarden
      tailscale
      bash
      gnome.gnome-tweaks
      gnomeExtensions.tophat
      gnomeExtensions.dash-to-panel
      woeusb
      vlc
      bspwn
      python3
      bottom
      fish
      terminator
      openvpn3
      tuba
      zoom-us
      popsicle
      gimp
      inkscape
      flameshot
      gnupg
      hugo
      tailscale
      starship
      zip
      rake
      rubyPackages.rake
      libgtop
      gtop
      flameshot
      pinentry
      pinentry-curses
      pinentry-gtk2
      pinentry-gnome
      brave

  <span style="color:#f92672">]</span>;

  <span style="color:#75715e"># Some programs need SUID wrappers, can be configured further or are</span>
  <span style="color:#75715e"># started in user sessions.</span>
  <span style="color:#75715e"># programs.mtr.enable = true;</span>
   programs.gnupg.agent <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
     enable <span style="color:#f92672">=</span> true;
     pinentryFlavor <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;gtk2&#34;</span>;
     enableSSHSupport <span style="color:#f92672">=</span> true;
  <span style="color:#75715e"># };</span>
  <span style="color:#75715e">#</span>
  <span style="color:#75715e"># List services that you want to enable:</span>

  <span style="color:#75715e"># Enable the OpenSSH daemon.</span>
   services.openssh.enable <span style="color:#f92672">=</span> true;
   services.syncthing <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
     enable <span style="color:#f92672">=</span> true;
     user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;randoneering&#34;</span>;
     dataDir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/home/randoneering/Documents/&#34;</span>; <span style="color:#75715e"># Default folder for new synced folders</span>
     configDir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/home/randoneering/Documents/.config/syncthing&#34;</span>;
     <span style="color:#f92672">}</span>;
  <span style="color:#75715e"># Open ports in the firewall.</span>
  <span style="color:#75715e"># networking.firewall.allowedTCPPorts = [ ... ];</span>
  <span style="color:#75715e"># networking.firewall.allowedUDPPorts = [ ... ];</span>
  <span style="color:#75715e"># Or disable the firewall altogether.</span>
  <span style="color:#75715e"># networking.firewall.enable = false;</span>

  <span style="color:#75715e"># This value determines the NixOS release from which the default</span>
  <span style="color:#75715e"># settings for stateful data, like file locations and database versions</span>
  <span style="color:#75715e"># on your system were taken. It‘s perfectly fine and recommended to leave</span>
  <span style="color:#75715e"># this value at the release version of the first install of this system.</span>
  <span style="color:#75715e"># Before changing this value read the documentation for this option</span>
  <span style="color:#75715e"># (e.g. man configuration.nix or on https://nixos.org/nixos/options.html).</span>
  system.stateVersion <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;23.05&#34;</span>; <span style="color:#75715e"># Did you read the comment?</span>

<span style="color:#f92672">}</span>

</code></pre></div>
  </div>

  <footer class="post-footer">

<div class="share-buttons">

    <a target="_blank" rel="noopener noreferrer" aria-label="share Stay awhile, and listen...to my nixOS journey! on linkedin"
        href="https://www.linkedin.com/in/justin-frye-b4b14763/">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
</div>

  </footer>
  <script src="https://giscus.app/client.js"
  data-repo="randoneering/hugosite"
  data-repo-id="R_kgDOJ7Rs5w"
  data-category="Announcements"
  data-category-id="DIC_kwDOJ7Rs584Ck7Xe"
  data-mapping="pathname"
  data-strict="0"
  data-reactions-enabled="1"
  data-emit-metadata="0"
  data-input-position="bottom"
  data-theme="transparent_dark"
  data-lang="en"
  crossorigin="anonymous"
  async>
</script>
</article>
    </main>
    
<footer class="footer">
    <span> Copyright© Randoneering 2024
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
